
# @TODO:
- [x] холст
- [x] паенель инструментов с фигурами
- [x] меню с фигурами
- [x] добавление фигур на холст (размеры по умолчанию, по центру)
- [x] выделение фигуры мышью
- [~] отображение прямоугольной рамки выделенной фигуры, с маркерами изменения размеров
- [x] снятие выделения с фигуры при клике на свободную от фигуры зону
- [x] перемещение выделенной фигуры таская за внутреннюю область фигуры
- [ ] изменение размеров фигруы, таская маркеры изменения размеров рамки выделения
- [ ] ограничить возможность переместить фигуру за рамки холста
- [x] удаление выделенной фигуры клавишей Delete или соответствующей кнопкой на панели или в меню
- [ ] устранить мерцание, если будет во время риования или изменения размера, при помощи двойной буферизации
- Бонусы:
    - [ ] отмена и повтор операций (undo, redo). Восстановление на том же слое с сохранением размеров и положения
    - [ ] сохранение и загрузка документа в файл (json, xml). Реализация операции Open, Save, Save as
    - [ ] покрытие тестами классов не связанных с визуализацией
- Вставка растровых изображений:
    - [ ] вставка растровых изображений (хотябы в одном графическм формате)
    - [ ] управление растровыми изображениями на равне с другими объектами холста: перемещать, изменять размер, удалять (ссылка на вставленный файл не должна использоваться), отмена, повтор операции
    - [ ] при отмене вставки или удалении изображение не должно храниться в памяти
    - [ ] при повторе вставке или отмене удаления, изображение должно загрузаться из временного хранилища, куда должно помещатсья в момент первоначальной вставки
    - [ ] при удалении изображения с холста и из истории команд, оно должно удаляться из хранилища
    - [ ] при сохранении документа, файлы находящихся в нём изображений должны сохраняться рядом с ним (возмоно в подкаталог), в файле должны храниться относительный пети к изображениям
    - [ ] при загрузке документа, изображения должны загружаться из файлов по путям, относительно файла документа, предусмотреть обработку ошибок работы с файлами 



# Вопросы:
- [x] селекшн модель, содержит список выбранных фигур, обалдает методами добалвения к выбранным, удаления из выбранных и перебором выбранных, проверки выбрана ли фигура?
- [x] как view рисует свое выделение



# Замечания:
- селекшн модель можно сделать одну для доменных и одну для вью моделей
+ [+] селекшн модель следит за фигурами (например удалиться какая-то то и из селекшн удалиться)
+ [+] можно сделтаь отдельный обсервер интерфес для документа и отдельный для шейп (у документа кроме update методы addedshape, removed shape - чтоб те же селекшн модели удаляли у себя удалённую, и чтоб канвас вью добавлял новую шейп вью для добавленной и дулял для удалённой)
+ [+] канвас создает вьюшки один раз, по событиям добавления доабвляет, по удалению удаляет
- [~] сделать шайп вью компонентами, чтоб они ами слушали события кликов и рисовались по общим правилам
- если не выйдет, можно слушать события на канвасе и перебирать вью шейпов и им передавать события если клик по ним
- посмотреть исходники deawio, как у них это реализовано
- селекшн вью это как отдельный слой, он рисует рамки выделенных фигур, отслеживает доменную модель, отслеживает вью модели  
+ [+] на этом слое тоже вьюшки выделений - фреймов, отдельные, каждый за своей фигурой следит
- и эта вьюшка выделения понимает про свои углы выделения, при клике определяет за который тянет и передает контроллеру уже конкретное значение
- коанды используют юзкейсы или юзкейсы команды?
+ [+] добавить в документ метод получения индекса фигуры, это нужно для команд, чтоб знать куда её потом посстанавшивать
+ [+] юзкейсу перемещения перемещаемый объект может пригодится для дополнительных действий
+ [~] в шейп вью добавить свой фрейм, инициализировав фреймом отследиваемой фигуры, ищменять его значения через контроллер в процессе перемещений, а при завершении перемещений отдавать его значения контроллеру чтоб он записал значения в доменную модель 
+ [+] (кстати про отследивание фигуры - нужно перерисовывать шейп вью при измененииях в модели шейпа)
- юзкейсы перемещения можно сделать двумя методами и по новой координате и по относительному смещению, если по новой точке то как-раз старая точка передвигаемого объекта возьмется и посчитается на сколько сместили

+ [+] селекшн вью - слой выделений, состоящий из вьюшек выделенных фигур, которые получает от селекшн модели, изменения в которой случает
- контроллеры вьюшки реализуют методы которые можно сделать над вьюшекой, например вью шейпа - можно выделить; вью выделения - можно потащить - изменить размер, переместить 

+ [+] canvasView - соитоит из рисуемых вьюшек: это вьюшки фигур, вьшка выделений фигур, реагирует на события документа
+ [+] shapeView - рисует фигуру, её расположение и размеры, цвет, реагирует на события изменения своей фигуры  (её размерами, расположением. цветом) и действия пользователя над её отображаемой частью
- [~] selectionShapeView - рисует рамку выделения фигуры, отслеживает изменения фигуры (если нужно?) и изменения вьюшки фигуры (чтобы в нужном месте текущую рамку рисовать), и действий пользвоателя над ней - клики по рамке и каскание точек рамки, содержит свой фрейм и набор точек (которые тоже могут иметь свои вьюшки каждая)

- когда вьюшка вызывает метод контроллера о таскании - когда получил от пользователя такое событие и оно внутри фигуры
- когда вьюшка вызывает метод изменения размера - когда получит от пользвоатея событие таскания, с активной после первого клика точкой таскания (активной в смысле зажатой в её радиусе - это вьюша выделения или даже вьюшка точки рамки)
- 

## что сделать:
- [x] реализовать выделения через отдельную модель содержащую список выделенных и следящеё за изменениями статуса фигур
- [~] реализовать рисование модели выделения через вьюшки выделений каждой из фигур
- [x] сделать методы событий изменения документа и слушание этих событий канвасом для создания новых вьюшек и уделания не актулаьных, вьюшки создавать только один раз
- [~] попробовать сделать ьюшки фигур компонентами
- [~] добавить вьюшкками фигур фрейм чтоб перемещать его до обновления модели, слушать изменения фрейма и цвета в своей фигуре
- [x] реализваоть передачу событий кликов в вьюшку фигуры, и через неё в контроллер фигуры, а дальше в селекшн модель 
- [x] реализовать рисование селекшн модели через велексш вьюшки, с отслеживаниями сосояний фигур, если надо (как минимум размеры и координаты фреймов)
+ [x] реализовать перемещение выделенных фигур
- реализовать взаимодействие с точками выделенного фрейма, передачу события таскания для изменения размера
- реализовать изменение размера выделенных фигур
- [x] реализовать удаление выделенных фигур клавишей del - проследить что событие растпространится и удалятся лишние вьюшки
- как только с отображением будет готово - перейти на реализацию команд
- после реализации команд - реализвоать отмену и повтор через команды
- затем реализовать созраннеие и загрузку документа
- покрыть тестами классы которые останутсяне покрыты
- реализовать вставку изорбажения
- реализвоать методы для управления изорабжением как с фигурами (по сути ничего и делать не надо только отоюражениеи персечение)
- реализовать корректное отмену и повтор с изображением, его сохранение, хранилище изображений, загрузка документа с изорбажениями


## Вопросы:
- как вью селенксш модели фигуры следить и за шейп вью? шейп вью создйются в канвас вью, а вью селекшн модели фигуры в селекшен вью, которая создайт в канвас вью (возможно селекшн вью будет слушать изменения в канвас вью - события изменения фигуры, в которую будут передаваться фреймы шейп вью?)
- шейп вью при таскании себя должна проверить что она выделена, значит зависит от селенкс модели. может все-таки таскать вьюшку через контроллер?